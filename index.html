<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR Camera Pose</title>
</head>
<body>
    <h1>WebXR Camera Pose</h1>
    <p id="cameraPose"></p>

    <script>
        // Check if WebXR is supported
        if ('xr' in navigator) {
            // Request an XR session
            navigator.xr.requestSession('immersive-ar').then(onXRSessionStarted).catch(onError);
        } else {
            // WebXR not supported, display an error message
            onError('WebXR is not supported in this browser.');
        }

        function onXRSessionStarted(session) {
            // Set up session end listener
            session.addEventListener('end', onXRSessionEnded);

            // Request the reference space
            session.requestReferenceSpace('local').then((refSpace) => {
                // Start rendering loop
                session.requestAnimationFrame(onXRFrame);

                // Function to handle each frame update
                function onXRFrame(time, frame) {
                    // Request the pose of the viewer
                    const pose = frame.getViewerPose(refSpace);
                    
                    if (pose) {
                        // Extract the transform of the viewer
                        const viewerTransform = pose.transform;
                        
                        // Extract position and orientation from the transform
                        const position = viewerTransform.position;
                        const orientation = viewerTransform.orientation;

                        // Display the camera pose
                        displayCameraPose(position, orientation);
                    }

                    // Request the next animation frame
                    session.requestAnimationFrame(onXRFrame);
                }
            }).catch(onError);
        }

        function onXRSessionEnded(event) {
            // Handle session end
            console.log('XR session ended.');
        }

        function onError(error) {
            // Display error message
            console.error('WebXR error:', error);
            alert('WebXR error: ' + error);
        }

        function displayCameraPose(position, orientation) {
            // Update HTML element to display camera pose
            const cameraPoseElement = document.getElementById('cameraPose');
            cameraPoseElement.textContent = `Camera Position: [${position.x.toFixed(2)}, ${position.y.toFixed(2)}, ${position.z.toFixed(2)}] | Camera Orientation: [${orientation.x.toFixed(2)}, ${orientation.y.toFixed(2)}, ${orientation.z.toFixed(2)}, ${orientation.w.toFixed(2)}]`;
        }
    </script>
</body>
</html>
